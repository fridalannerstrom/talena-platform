{% extends "admin/core/layouts/admin_base.html" %}
{% block title %}Admin Dashboard | Talena{% endblock %}

{% block content %}

  <div class="row g-4">

    {# LEFT: Quick links (Customers) #}
    <div class="col-12 col-lg-5">
      <div class="card h-100">
        <div class="card-header">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <div class="fw-semibold">Kunder</div>
              <div class="small text-muted">Hantera kundkonton och inbjudningar.</div>
            </div>
          </div>
        </div>

        <div class="card-body">
          <div class="d-grid gap-2">
            <a class="btn btn-primary" href="{% url 'accounts:admin_customers_list' %}">
              Alla kunder
            </a>
            <a class="btn btn-outline-primary" href="{% url 'accounts:admin_customers_create' %}">
              Skapa ny kund
            </a>
          </div>

          <hr class="my-4">

          <div class="small text-muted">
            Tips: Inbjudna användare visas som <strong>Pending</strong> tills de satt lösenord.
          </div>
        </div>
      </div>
    </div>

    {# RIGHT: SOVA Projects list (keep as-is) #}
    <div class="col-12 col-lg-7">
      <div class="card h-100">
        <div class="card-header">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <div class="fw-semibold">SOVA Projects</div>
              <div class="small text-muted">Projekt hämtade från SOVA-kontot (används som mallar)</div>
            </div>
          </div>
        </div>

        <div class="card-body">

          {% if error %}
          <div class="alert alert-danger mb-3">
            Could not load projects: {{ error }}
          </div>
          {% endif %}

          {% for account in accounts %}
          <div class="card mb-4 border">
            <div class="card-header py-2 d-flex align-items-center justify-content-between">
              <div>
                <a class="fw-semibold text-decoration-none" href="#">
                  {{ account.name }}
                </a>
                <span class="text-muted small ms-1">({{ account.code }})</span>
              </div>
              <span class="badge bg-primary-soft text-primary">
                {{ account.projects|length }} projects
              </span>
            </div>

            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th style="width: 90px;">ID</th>
                    <th style="width: 190px;">Code</th>
                    <th>Name</th>
                    <th style="width: 120px;">Status</th>
                  </tr>
                </thead>
                <tbody>
                  {% for p in account.projects %}
                  <tr role="button" onclick="window.location='{% url 'sova_project_detail' account.code p.code %}'">
                    <td class="text-muted">{{ p.id }}</td>
                    <td><span class="font-monospace">{{ p.code }}</span></td>
                    <td class="fw-semibold">{{ p.name }}</td>
                    <td>
                      {% if p.active %}
                      <span class="badge bg-success-soft text-success">Active</span>
                      {% else %}
                      <span class="badge bg-secondary-soft text-secondary">Inactive</span>
                      {% endif %}
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="4" class="text-muted p-3">No projects found for this account.</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          {% empty %}
          <div class="text-muted">No accounts returned from SOVA.</div>
          {% endfor %}

        </div>
      </div>
    </div>

  </div>

{% endblock %}