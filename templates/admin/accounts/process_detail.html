{% extends "admin/core/layouts/admin_base.html" %}
{% block title %}Admin Dashboard | Talena{% endblock %}

{% block content %}

<div class="container-fluid px-2 px-md-3">

  <div class="d-flex align-items-start justify-content-between mb-3">
    <div>
      <h2 class="h4 mb-1">{{ process.name }}</h2>
      <div class="text-muted">
        Owner: {{ process.created_by.email }} |
        Created: {{ process.created_at|date:"Y-m-d H:i" }}
      </div>
      <div class="text-muted">
        Account: {{ process.account_code }} | Project: {{ process.project_code }}
      </div>
    </div>

    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary btn-sm"
         href="{% url 'accounts:admin_user_detail' pk=process.created_by.id %}">
        ← Back to user
      </a>

      <button class="btn btn-outline-secondary btn-sm" type="button" disabled title="Coming soon">
        Download results
      </button>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-header fw-semibold">Quick status</div>
    <div class="card-body">
      <div class="d-flex flex-wrap gap-2">
        <span class="badge bg-light text-dark">Created: {{ status_counts.created|default:0 }}</span>
        <span class="badge bg-light text-dark">Sent: {{ status_counts.sent|default:0 }}</span>
        <span class="badge bg-light text-dark">Started: {{ status_counts.started|default:0 }}</span>
        <span class="badge bg-light text-dark">Completed: {{ status_counts.completed|default:0 }}</span>
        <span class="badge bg-light text-dark">Expired: {{ status_counts.expired|default:0 }}</span>
        <span class="badge bg-light text-dark">Failed: {{ status_counts.failed|default:0 }}</span>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header fw-semibold">Candidates in process</div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Status</th>
              <th>Source</th>
              <th>Invited</th>
              <th>Completed</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for inv in invitations %}
              <tr>
                <td>{{ inv.candidate.first_name }} {{ inv.candidate.last_name }}</td>
                <td class="text-muted">{{ inv.candidate.email }}</td>
                <td>
                  <span class="badge bg-light text-dark">{{ inv.status_label }}</span>
                </td>
                <td class="text-muted">{{ inv.get_source_display }}</td>
                <td class="text-muted">{{ inv.invited_at|date:"Y-m-d H:i"|default:"—" }}</td>
                <td class="text-muted">{{ inv.completed_at|date:"Y-m-d H:i"|default:"—" }}</td>

                <td class="text-end">
                  {% if inv.assessment_url %}
                    <a class="btn btn-outline-primary btn-sm" href="{{ inv.assessment_url }}" target="_blank">
                      Open link
                    </a>
                  {% else %}
                    <button class="btn btn-outline-secondary btn-sm" disabled>No link</button>
                  {% endif %}

                  <button class="btn btn-outline-secondary btn-sm" type="button" disabled title="Coming soon">
                    Restart
                  </button>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="7" class="text-muted p-3">No candidates yet.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>

{% endblock %}