{% extends "../core/layouts/customer_base.html" %}

{% block content %}
<div class="container-fluid px-2 px-md-3">
  <div class="d-flex align-items-start justify-content-between mb-3">
    <div>
      <h2 class="h4 mb-1">Change password</h2>
      <div class="text-muted">Choose a strong password you haven’t used before.</div>
    </div>

    {# Back-länk: byt URL efter context #}
    <a class="btn btn-outline-secondary btn-sm" href="{% url 'portal:settings' %}">
      Back to settings
    </a>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} mb-3" role="alert">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  {% if form.non_field_errors %}
    <div class="alert alert-danger mb-3" role="alert">
      {% for err in form.non_field_errors %}
        <div>{{ err }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="card">
    <div class="card-header fw-semibold">Update password</div>
    <div class="card-body">
      <form method="post" class="row g-3">
        {% csrf_token %}

        <div class="col-12">
          <label class="form-label" for="{{ form.old_password.id_for_label }}">Current password</label>
          {{ form.old_password }}
          {% for err in form.old_password.errors %}
            <div class="text-danger small mt-1">{{ err }}</div>
          {% endfor %}
        </div>

        <div class="col-md-6">
          <label class="form-label" for="{{ form.new_password1.id_for_label }}">New password</label>
          {{ form.new_password1 }}
          {% if form.new_password1.help_text %}
            <div class="form-text">{{ form.new_password1.help_text|safe }}</div>
          {% endif %}
          {% for err in form.new_password1.errors %}
            <div class="text-danger small mt-1">{{ err }}</div>
          {% endfor %}
        </div>

        <div class="col-md-6">
          <label class="form-label" for="{{ form.new_password2.id_for_label }}">Confirm new password</label>
          {{ form.new_password2 }}
          {% for err in form.new_password2.errors %}
            <div class="text-danger small mt-1">{{ err }}</div>
          {% endfor %}
        </div>

        <div class="col-12 d-flex gap-2">
          <button class="btn btn-primary" type="submit">Update password</button>
          <a class="btn btn-light" href="{% url 'portal:settings' %}">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Bootstrap styles for Django widgets
  (function () {
    const ids = [
      "{{ form.old_password.id_for_label }}",
      "{{ form.new_password1.id_for_label }}",
      "{{ form.new_password2.id_for_label }}"
    ];
    ids.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.classList.add("form-control");
    });
  })();
</script>
{% endblock %}
