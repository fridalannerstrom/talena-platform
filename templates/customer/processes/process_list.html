{% extends "customer/core/layouts/customer_base.html" %}
{% block content %}
<div class="container-fluid px-2 px-md-3">

  <!-- Header -->
  <div class="d-flex align-items-start justify-content-between mb-4">
    <div>
      <h1 class="h4 mb-1">Testprocesser</h1>
      <div class="text-muted">Översikt över dina testprocesser och status.</div>
    </div>
    <a class="btn btn-primary" href="{% url 'processes:process_create' %}">
      Skapa testprocess
    </a>
  </div>

<div class="card">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4">Titel</th>
              <th>Testpaket</th>
              <th class="text-center">Kandidater</th>
              <th>Skapad</th>
              <th class="text-end pe-4"></th>
            </tr>
          </thead>

          <tbody>
            {% for p in processes %}
            <tr class="clickable-row"
    data-href="{% url 'processes:process_detail' p.id %}">
              <td class="ps-4">
                <div class="d-flex flex-column">
                  <a class="fw-semibold text-decoration-none" href="{% url 'processes:process_detail' p.id %}">
                    {{ p.name }}
                  </a>
                </div>
              </td>

              <td>
                <div class="fw-medium">{{ p.project_name_snapshot }}</div>
              </td>

              <td class="text-center">
                <span class="badge bg-light text-dark border">
                  {{ p.candidates_count }}
                </span>
              </td>

              <td class="text-muted">
                {{ p.created_at|date:"Y-m-d" }}
              </td>

              <td class="text-end pe-4">
                <div class="d-inline-flex gap-2 align-items-center">
                  <a class="button-icon"
                     href="{% url 'processes:process_update' p.id %}">
                    <i data-feather="edit"></i>
                  </a>

                  <form method="post"
                        action="{% url 'processes:process_delete' p.id %}"
                        class="d-inline"
                        onsubmit="return confirm('Är du säker på att du vill ta bort denna process?');">
                    {% csrf_token %}
                    <button type="submit" class="button-icon">
                      <i data-feather="trash-2"></i>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="p-5 text-center">
                <div class="text-muted mb-2">Du har inga testprocesser ännu.</div>
                <a class="btn btn-dark rounded-pill px-4" href="{% url 'processes:process_create' %}">
                  Skapa din första testprocess
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
</div>
</div>

<script>
  document.querySelectorAll(".clickable-row").forEach(row => {
    row.addEventListener("click", function (e) {
      // Om man klickar på knappar eller ikoner → ignorera
      if (
        e.target.closest("a") ||
        e.target.closest("button")
      ) {
        return;
      }

      const href = this.dataset.href;
      if (href) {
        window.location.href = href;
      }
    });
  });
</script>
{% endblock %}

