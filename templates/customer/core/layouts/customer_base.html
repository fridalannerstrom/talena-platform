{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />

  <title>{% block title %}Talena{% endblock %}</title>

  <link href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" rel="stylesheet" />
  <link href="{% static 'css/style.css' %}" rel="stylesheet" />
  <link rel="icon" type="image/x-icon" href="" />
  <script src="https://kit.fontawesome.com/e2348d3361.js" crossorigin="anonymous"></script>

  {# Icons #}
  <script data-search-pseudo-elements defer src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/js/all.min.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js" crossorigin="anonymous"></script>

  {% block extra_css %}{% endblock %}
</head>

<body class="nav-fixed">

  {% include "../partials/customer_header.html" %}

  <div id="layoutSidenav">
    {% include "../partials/customer_sidebar.html" %}

    <div id="layoutSidenav_content">
      <main>
        <div class="container-xl px-4 mt-5">
        {% block content %}{% endblock %}
        </div>
      </main>

      {% include "../partials/customer_footer.html" %}
    </div>
  </div>

  <!-- Global Modal (re-usable) -->
<div class="modal fade" id="appModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="appModalTitle">Modal</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body" id="appModalBody">
        <!-- injected content -->
      </div>

      <div class="modal-footer" id="appModalFooter">
        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
  function openAppModal({ title, bodyHtml, footerHtml }) {
    const titleEl = document.getElementById("appModalTitle");
    const bodyEl = document.getElementById("appModalBody");
    const footerEl = document.getElementById("appModalFooter");

    titleEl.textContent = title || "Modal";
    bodyEl.innerHTML = bodyHtml || "";
    footerEl.innerHTML = footerHtml || `
      <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
    `;

    const modal = new bootstrap.Modal(document.getElementById("appModal"));
    modal.show();
  }

  async function copyToClipboard(text, statusElId) {
    try {
      await navigator.clipboard.writeText(text);
      if (statusElId) {
        const el = document.getElementById(statusElId);
        if (el) {
          el.textContent = "Copied!";
          el.classList.remove("text-muted");
          el.classList.add("text-success");
          setTimeout(() => {
            el.textContent = "";
          }, 2000);
        }
      }
    } catch (e) {
      console.error("Copy failed:", e);
      alert("Could not copy. Please copy manually.");
    }
  }
</script>


  <script>
    (function () {
      const input = document.getElementById("globalSearchInput");
      const menu = document.getElementById("globalSearchDropdown");
      if (!input || !menu) return;

      let timer = null;
      let lastQuery = "";
      let abortController = null;

      function hideMenu() {
        menu.classList.remove("show");
        menu.innerHTML = "";
      }

      function showMenu(html) {
        menu.innerHTML = html;
        menu.classList.add("show");
      }

      function escapeHtml(str) {
        return (str || "").replace(/[&<>"']/g, (m) => ({
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#039;"
        }[m]));
      }

      async function runSearch(query) {
        if (abortController) abortController.abort();
        abortController = new AbortController();

        const res = await fetch(`/search/?q=${encodeURIComponent(query)}`, {
          signal: abortController.signal,
          headers: { "X-Requested-With": "XMLHttpRequest" }
        });

        if (!res.ok) return [];
        const data = await res.json();
        return data.results || [];
      }

      function iconFor(type) {
        if (type === "candidate") return "üë§";
        if (type === "process") return "üß™";
        if (type === "customer") return "üè¢";
        return "üîé";
      }

      function badgeLabel(type) {
        if (type === "customer") return "Kund";
        if (type === "candidate") return "Kandidat";
        if (type === "process") return "Testprocess";
        return "";
      }

      input.addEventListener("input", () => {
        const q = input.value.trim();

        if (q.length < 2) {
          hideMenu();
          return;
        }
        if (q === lastQuery) return;
        lastQuery = q;

        clearTimeout(timer);
        timer = setTimeout(async () => {
          try {
            const results = await runSearch(q);

            if (!results.length) {
              showMenu(`<span class="dropdown-item-text text-muted">Inga tr√§ffar</span>`);
              return;
            }

            const html = results.map(r => `
  <a class="dropdown-item d-flex align-items-center justify-content-between py-2"
     href="${escapeHtml(r.url)}">

    <span class="fw-medium text-body">
      ${escapeHtml(r.label)}
    </span>

    <span class="search-tag">
      ${badgeLabel(r.type)}
    </span>
  </a>
`).join("");

            showMenu(html);
          } catch (e) {
            if (e.name !== "AbortError") hideMenu();
          }
        }, 180);
      });

      document.addEventListener("click", (evt) => {
        if (!menu.contains(evt.target) && evt.target !== input) hideMenu();
      });

      input.addEventListener("keydown", (evt) => {
        if (evt.key === "Escape") hideMenu();
      });
    })();
  </script>

  {# Vendor JS (globalt) #}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script src="{% static 'js/scripts.js' %}"></script>

  {# Optional vendor libs that many pages might use #}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/bundle.js" crossorigin="anonymous"></script>

  {# Per-page JS #}
  {% block extra_js %}{% endblock %}

  <script>
    // Feather icons init (bra att ha globalt)
    if (window.feather) feather.replace();
  </script>



</body>
</html>
