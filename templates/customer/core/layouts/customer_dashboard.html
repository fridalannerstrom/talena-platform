{% extends "customer/core/layouts/customer_base.html" %}
{% block content %}
{% load static %}

<div class="container-fluid px-2 px-md-3 dashboard">
  <div class="d-flex align-items-center gap-3 mb-3">

    <!-- Liten bild -->
    <div class="dashboard-avatar">
      <img src="{% static 'images/talena-welcome.png' %}" alt="Greeting icon">
    </div>

    <!-- Text -->
    <div>
      <h1 id="greeting" class="mb-1">
        Hej, {{ request.user.first_name|default:request.user.get_username }}!
      </h1>

      <p class="dashboard-date mb-0" id="today-date"></p>
    </div>

  </div>

<section class="quick-access mt-3 py-3">
  <h3>Vad vill du göra?</h3>

  <div class="quick-access-grid">

    <a href="{% url 'processes:process_create' %}" class="quick-card">
      <div class="quick-card-icon"><i data-feather="plus"></i></div>
      <div class="quick-card-title">Skapa ny testprocess</div>
      <div class="quick-card-desc">Skicka ut tester till kandidater</div>
    </a>

    <a href="{% url 'processes:process_list' %}" class="quick-card">
      <div class="quick-card-icon"><i data-feather="list"></i></div>
      <div class="quick-card-title">Se dina testprocesser</div>
      <div class="quick-card-desc">Se status och resultat</div>
    </a>

    <a href="{% url 'portal:settings' %}" class="quick-card">
      <div class="quick-card-icon"><i data-feather="settings"></i></div>
      <div class="quick-card-title">Kontoinställningar</div>
      <div class="quick-card-desc">Lösenord, profilbild, kontaktinformation</div>
    </a>

  </div>
</section>



  <!-- Main content -->
  <div class="row g-5 mt-1">

    <!-- Left: Stats + Recent activity -->

    <div class="col-12 col-xl-8">
         <!-- Stats -->
          <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
            <div>
              <h3 class="mb-1">Översikt</h3>
              <div class="text-muted small">Snabb status på dina senaste tester</div>
            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-12 col-md-3">
              <div class="border rounded-3 p-3 h-100">
                <div class="text-muted small">Testprocesser</div>
                <div class="h3 mt-1">{{ stats.processes }}</div>
              </div>
            </div>

            <div class="col-12 col-md-3">
              <div class="border rounded-3 p-3 h-100">
                <div class="text-muted small">Skickade tester</div>
                <div class="h3 mt-1">{{ stats.sent }}</div>
              </div>
            </div>

            <div class="col-12 col-md-3">
              <div class="border rounded-3 p-3 h-100">
                <div class="text-muted small">Påbörjade tester</div>
                <div class="h3 mt-1">{{ stats.started }}</div>
              </div>
            </div>
            
            <div class="col-12 col-md-3">
              <div class="border rounded-3 p-3 h-100">
                <div class="text-muted small">Färdiga tester</div>
                <div class="h3 mt-1">{{ stats.completed }}</div>
              </div>
            </div>
          </div>

      <!-- Tesprocesses -->
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3 mt-3">
      <div>
        <h3 class="mb-1 mt-3">Senaste testprocesser</h3>
        <div class="text-muted small">Snabb åtkomst till det du jobbar med just nu</div>
      </div>

      <a href="{% url 'processes:process_list' %}"
         class="btn btn-outline-primary btn-sm rounded-pill mt-3">
        Visa alla
      </a>
    </div>
{% if processes %}
  <div class="process-rows">
    {% for p in processes %}
      <a href="{% url 'processes:process_detail' p.id %}"
         class="process-row process-row-link">

        {# COL 2: Name + tests #}
        <div class="process-col-main min-w-0">
          <div class="process-name text-truncate">
            {{ p.name }}
          </div>
          <div class="process-sub text-muted small text-truncate">
            Innehåller tester: {{ p.tests_display|default:"Personlighet, Motivation" }}
          </div>
        </div>

                {# COL 1: Label/Org unit #}
        <div class="process-col-label">
          <span class="process-label">
            {% if p.org_unit %}{{ p.org_unit.name }}{% else %}Enhet{% endif %}
          </span>
        </div>



        {# COL 3: Candidates #}
        <div class="process-col-meta text-muted small">
          <i class="fa-solid fa-user-group me-1"></i>
          <span class="fw-semibold text-dark">{{ p.candidates_count|default:"0" }}</span>
        </div>

        {# COL 4: Date #}
        <div class="process-col-date text-muted small">
          <i class="fa-solid fa-calendar-days me-1"></i>
          {{ p.created_at|date:"Y-m-d" }}
        </div>

      </a>
    {% endfor %}
  </div>

{% else %}
  <div class="p-3 border rounded bg-light">
    <div class="text-muted">Inga aktiva testprocesser ännu.</div>
    <a class="btn btn-primary btn-sm mt-2" href="{% url 'processes:process_create' %}">
      Skapa testprocess
    </a>
  </div>
{% endif %}

</div>

   <!-- Right: To-do + Activity feed -->
    <div class="col-12 col-xl-4">
           <!-- Activity feed -->
      <div class="card">
        <div class="card-body">
          <h4 class="mb-1">Senaste aktivitet</h4>
          <div class="text-muted small mb-3">Händelser från dina processer</div>

          <div class="d-flex flex-column gap-3">
            <div class="d-flex gap-3">
              <div class="rounded-circle border" style="width:10px;height:10px;margin-top:6px;"></div>
              <div>
                <div class="fw-semibold">1 kandidat lades till</div>
                <div class="text-muted small">Process: Säljare • 12:03</div>
              </div>
            </div>

            <div class="d-flex gap-3">
              <div class="rounded-circle border" style="width:10px;height:10px;margin-top:6px;"></div>
              <div>
                <div class="fw-semibold">2 tester slutförda</div>
                <div class="text-muted small">Process: Administratör • Igår</div>
              </div>
            </div>

            <div class="d-flex gap-3">
              <div class="rounded-circle border" style="width:10px;height:10px;margin-top:6px;"></div>
              <div>
                <div class="fw-semibold">1 testprocess skapad</div>
                <div class="text-muted small">Process: Projektledare • 2026-02-10</div>
              </div>
            </div>

          </div>

</div>
</div>
</div>

<style>.process-rows{
  display: grid;
  gap: .55rem;
}

/* Gör hela raden till en snygg "row" men som länk */
.process-row-link{
  display: grid;
  grid-template-columns: 1fr auto 110px 140px;
  gap: .9rem;
  align-items: center;

  padding: .75rem .9rem;
  border: 1px solid rgba(0,0,0,.10);
  border-radius: 10px;
  background: #fff;

  text-decoration: none;
  color: #000;
}

.process-row-link:hover{
  background: rgba(0,0,0,.015);
  border-color: rgba(0,0,0,.16);
}

.process-row-link:focus{
  outline: none;
  box-shadow: 0 0 0 .2rem rgba(13,110,253,.15);
}

.process-chip{
  font-weight: 500;
  padding: .28rem .6rem;
  max-width: 120px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.process-name{
  font-weight: 600;
}

.process-sub{
  margin-top: .15rem;
}

/* Responsive: rad blir två rader */
@media (max-width: 992px){
  .process-row-link{
    grid-template-columns: 1fr auto;
    grid-template-areas:
      "main meta"
      "label date";
    align-items: start;
  }

  .process-col-main{ grid-area: main; }
  .process-col-meta{ grid-area: meta; justify-self: end; }
  .process-col-label{ grid-area: label; }
  .process-col-date{ grid-area: date; justify-self: end; }
}
</style>

<script>
  (function () {
    const now = new Date();
    const hour = now.getHours();

    let greeting = "Hej";
    if (hour < 10) greeting = "God morgon";
    else if (hour < 13) greeting = "Välkommen";
    else if (hour < 17) greeting = "God eftermiddag";
    else greeting = "God kväll";

    const greetingEl = document.getElementById("greeting");
    if (greetingEl) {
      greetingEl.innerText = greeting + ", " + greetingEl.innerText.split(",")[1];
    }

    const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
    const dateStr = now.toLocaleDateString('sv-SE', options);

    const dateEl = document.getElementById("today-date");
    if (dateEl) {
      dateEl.innerText = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);
    }
  })();
</script>


{% endblock %}
